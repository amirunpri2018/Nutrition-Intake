<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>Food Groups</title>
<link rel="stylesheet" href="css/style.css?v=1">
<script src="js/libs/jquery.min.js"></script>
<script src="js/libs/underscore.js"></script>
<script src="js/libs/raphael.js"></script>
<script src="js/data/groups/ethnic_foods.js"></script>
<script>
var foods = foodgroups[3500].foods;
var nutrients = {};
var _i = 0;
_(foods)
  .chain()
  .pluck('nutrients')
  .flatten()
  .each(function(nut) {
    nutrients[nut.id] = nutrients[nut.id] || {max: 0, i: _i++};
    if (nut.amount > nutrients[nut.id].max)
      nutrients[nut.id].max = nut.amount;
  });


$(function() {
  var canvas = document.getElementById('chart');
  if (canvas.getContext){
    var c = canvas.getContext('2d');
    c.font = "7px Helvetica";
    c.strokeStyle = "black";
    _(nutrients).each(function(v,k) {
      c.fillText(k, 0, 7*v.i);
    });
    _(foods).each(function(food, i) {
      _(food.nutrients).each(function(nut, j) {
        c.fillStyle = intensity(nut.amount/nutrients[nut.id].max);
        c.fillRect(20 + 7*i,7*nutrients[nut.id].i,7,7);
      });
    });
  } else {
    alert('This visualization requires a browser which supports canvas');
  }
});

function randomColor() {
  return ["rgb(", Math.round(255*Math.random()), ",", Math.round(255*Math.random()), ",", Math.round(255*Math.random()), ")"].join("");
};
function intensity(i) {
  return ["rgb(20,", Math.round(255*i), ",20)"].join("");
};
</script>
</head>
<body>
<div id="container">
  <header>
    <h1>Matrix Plot</h1>
  </header>
  <div id="main">
    <canvas id="chart" width="1300" height="900"></canvas>
  </div>
</div>
</body>
</html>
